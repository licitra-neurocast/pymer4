<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Simulating Data &#8212; pymer4 0.7.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Pymer4</a>
        <span class="navbar-text navbar-version pull-left"><b>0.7.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Tutorial</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="https://github.com/ejolly/pymer4">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page TOC <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Simulating Data</a><ul>
<li><a class="reference internal" href="#generating-standard-regression-data">Generating standard regression data</a></li>
<li><a class="reference internal" href="#generating-multi-level-regression-data">Generating multi-level regression data</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-example-03-simulating-data-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="simulating-data">
<span id="sphx-glr-auto-examples-example-03-simulating-data-py"></span><h1>Simulating Data<a class="headerlink" href="#simulating-data" title="Permalink to this headline">¶</a></h1>
<p><code class="code docutils literal notranslate"><span class="pre">pymer4</span></code> comes with some easy-to-use functions for simulating data that can be modeled with <code class="code docutils literal notranslate"><span class="pre">Lm()</span></code> and multi-level data that can be modeled with <code class="code docutils literal notranslate"><span class="pre">Lmer()</span></code>. These functions can be found in the <code class="code docutils literal notranslate"><span class="pre">pymer4.simulate</span></code> module and are aptly named: <code class="code docutils literal notranslate"><span class="pre">simulate_lm()</span></code> and <code class="code docutils literal notranslate"><span class="pre">simulate_lmm()</span></code> respectively.</p>
<p><code class="code docutils literal notranslate"><span class="pre">pymer4</span></code> gives you a lot of control over what you want your data to look like by setting properties such as:</p>
<ul class="simple">
<li><p>Number of data points and number of coefficients</p></li>
<li><p>Specific coefficient values</p></li>
<li><p>Means and standard deviations of predictors</p></li>
<li><p>Correlations between predictors</p></li>
<li><p>Amount of error (noise) in the data</p></li>
<li><p>Number of groups/clusters (multi-level data only)</p></li>
<li><p>Variance of random effects (multi-level data only)</p></li>
</ul>
<div class="section" id="generating-standard-regression-data">
<h2>Generating standard regression data<a class="headerlink" href="#generating-standard-regression-data" title="Permalink to this headline">¶</a></h2>
<p>Generating data for a standard regression is simple and returns a pandas dataframe with outcome and predictor variables ready for use with <code class="code docutils literal notranslate"><span class="pre">Lm()</span></code>, along with a vector of coefficients used to produce the data.</p>
<p>Let’s generate 500 observations, with predictors with the values: 1.2, -40.1, and 3. We also have an intercept with a value of 100. The means of the columns of our design matrix (i.e. means of the predictors) will be: 10, 30, and 1. We’ll also add noise from a normal distribution with mean = 0, and sd = 5. Any correlations between predictors are purely random.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymer4.simulate</span> <span class="k">import</span> <span class="n">simulate_lm</span>

<span class="n">data</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">simulate_lm</span><span class="p">(</span>
    <span class="mi">500</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">coef_vals</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">40.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">mus</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">noise_params</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;True coefficients:</span><span class="se">\n</span><span class="si">{b}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Data:</span><span class="se">\n</span><span class="s2">{data.head()}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True coefficients:
[100, 1.2, -40.1, 3]

Data:
            DV        IV1        IV2       IV3
0 -1090.300418  11.502450  30.286516  2.309898
1 -1099.941064   8.187192  30.278491  1.718110
2 -1046.515779  11.039804  28.953171  0.403214
3 -1050.762121   9.720598  29.288062  0.871281
4 -1049.463841  11.008839  29.148838  1.555108
</pre></div>
</div>
<p>Here are some checks you might do to make sure the data correctly generated:</p>
<p>Check mean of predictors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>IV1     9.992834
IV2    29.983225
IV3     1.041560
dtype: float64
</pre></div>
</div>
<p>Check correlations between predictors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">corr</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>          IV1       IV2       IV3
IV1  1.000000  0.027562  0.054908
IV2  0.027562  1.000000 -0.011895
IV3  0.054908 -0.011895  1.000000
</pre></div>
</div>
<p>Check coefficient recovery</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymer4.models</span> <span class="k">import</span> <span class="n">Lm</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Lm</span><span class="p">(</span><span class="s2">&quot;DV ~ IV1+IV2+IV3&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">summarize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Estimate&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Intercept    102.418462
IV1            1.392601
IV2          -40.232719
IV3            2.759236
Name: Estimate, dtype: float64
</pre></div>
</div>
<p>However, you have the option of being as general or specific as possible when generating data. For example let’s generate 100 observations with 5 predictors from a standard normal distribution, i.e. mean = 0, sd = 1 with no (random) correlations between predictors, and let <code class="code docutils literal notranslate"><span class="pre">pymer4</span></code> decide what to set the coefficient values to.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">simulate_lm</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-multi-level-regression-data">
<h2>Generating multi-level regression data<a class="headerlink" href="#generating-multi-level-regression-data" title="Permalink to this headline">¶</a></h2>
<p>Generating data for a multi-level regression is just as simple and returns a pandas dataframe with outcome and predictor variables ready for use with <code class="code docutils literal notranslate"><span class="pre">Lmer()</span></code>, another dataframe with group/cluster level estimates (i.e. BLUPs), and a vector of population-level coefficients.</p>
<p>Here’s an example generating 5000 observations, organized as 100 groups with 50 observations each. We’ll have three predictors with the values: 1.8, -2, and 10. We also have an intercept with a value of 4. The means of the columns of our design matrix (i.e. means of the predictors) will be: 10, 30, and 2. We’ll also introduce correlations between our predictors of r = .15. We’ll leave the default of standard normal noise i.e., mean = 0, and sd = 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymer4.simulate</span> <span class="k">import</span> <span class="n">simulate_lmm</span>

<span class="n">num_obs</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">num_coef</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_grps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">mus</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<span class="n">coef_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">corrs</span> <span class="o">=</span> <span class="mf">0.15</span>

<span class="n">data</span><span class="p">,</span> <span class="n">blups</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">simulate_lmm</span><span class="p">(</span>
    <span class="n">num_obs</span><span class="p">,</span> <span class="n">num_coef</span><span class="p">,</span> <span class="n">num_grps</span><span class="p">,</span> <span class="n">coef_vals</span><span class="o">=</span><span class="n">coef_vals</span><span class="p">,</span> <span class="n">mus</span><span class="o">=</span><span class="n">mus</span><span class="p">,</span> <span class="n">corrs</span><span class="o">=</span><span class="n">corrs</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;True coefficients:</span><span class="se">\n</span><span class="si">{b}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;BLUPs:</span><span class="se">\n</span><span class="s2">{blups.head()}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Data:</span><span class="se">\n</span><span class="s2">{data.head()}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>True coefficients:
[4.0, 1.8, -2, 10]

BLUPs:
      Intercept       IV1       IV2        IV3
Grp1   3.541282  2.221274 -1.883782   9.919219
Grp2   4.351719  1.965862 -2.300109   9.788001
Grp3   4.045521  2.160759 -2.206551  10.141856
Grp4   3.941121  1.674062 -2.402550   9.948170
Grp5   3.955737  1.364982 -2.280517   9.914629

Data:
          DV        IV1        IV2       IV3  Group
0 -19.751143   9.333098  31.077555  1.496844    1.0
1  -1.425602   9.121674  29.036280  3.061896    1.0
2 -22.612739   9.617132  30.617730  0.967337    1.0
3 -10.035614  10.671709  32.391089  2.372981    1.0
4   8.909193  11.533388  30.400587  3.874369    1.0
</pre></div>
</div>
<p>Again here are some checks you might do to make sure the data correctly generated (by default lmm data will generally be a bit noisier due to within and across group/cluster variance; see the API for how to customize this):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group the data before running checks</span>
<span class="n">group_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Group&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check mean of predictors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="n">grp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>             IV1        IV2       IV3
Group
1.0     9.741979  29.964409  1.953194
2.0     9.723950  30.099959  2.024193
3.0     9.850033  29.988568  2.124336
4.0    10.185484  29.915806  2.325619
5.0     9.803502  29.997538  2.030510
...          ...        ...       ...
96.0    9.811131  30.063745  1.850667
97.0    9.866158  30.098088  1.969615
98.0   10.183765  30.058090  1.839024
99.0    9.886020  30.022325  2.190552
100.0  10.106948  30.016156  2.042250

[100 rows x 3 columns]
</pre></div>
</div>
<p>Check correlations between predictors</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">group_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="n">grp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>                IV1       IV2       IV3
Group
1.0   IV1  1.000000  0.160822  0.172671
      IV2  0.160822  1.000000  0.190060
      IV3  0.172671  0.190060  1.000000
2.0   IV1  1.000000  0.075578  0.178050
      IV2  0.075578  1.000000  0.197167
...             ...       ...       ...
99.0  IV2  0.280550  1.000000  0.173634
      IV3  0.021437  0.173634  1.000000
100.0 IV1  1.000000  0.198930  0.132432
      IV2  0.198930  1.000000  0.350461
      IV3  0.132432  0.350461  1.000000

[300 rows x 3 columns]
</pre></div>
</div>
<p>Check coefficient recovery</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pymer4.models</span> <span class="k">import</span> <span class="n">Lmer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Lmer</span><span class="p">(</span><span class="s1">&#39;DV ~ IV1+IV2+IV3 + (IV1+IV2+IV3|Group)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">summarize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Estimate&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Model failed to converge with max|grad| = 0.408757 (tol = 0.002, component 1)

(Intercept)     3.340792
IV1             1.786467
IV2            -2.012067
IV3            10.039467
Name: Estimate, dtype: float64
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  7.825 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-example-03-simulating-data-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/57807c25794805a85f9ad797cce03ae9/example_03_simulating_data.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">example_03_simulating_data.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/7517bc72aea5061ffc194905dd7efc83/example_03_simulating_data.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">example_03_simulating_data.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2019, Eshin Jolly.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>